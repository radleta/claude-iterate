#!/bin/bash

# Pre-commit hook to prevent committing temporary workspace directories

# These directories are not .gitignored for AI agent compatibility,
# but should not be committed. AI agents treat .gitignored content
# differently, which can interfere with their operation.

BLOCKED_PATHS=(
    "^scratch/"
    "^claude-iterate/workspaces/"
)

FOUND_BLOCKED=false

for pattern in "${BLOCKED_PATHS[@]}"; do
    if git diff --cached --name-only | grep -q "$pattern"; then
        if [ "$FOUND_BLOCKED" = false ]; then
            echo "‚ùå Error: Cannot commit files from protected directories"
            echo ""
            FOUND_BLOCKED=true
        fi

        echo "Blocked path: $pattern"
        git diff --cached --name-only | grep "$pattern" | sed 's/^/  /'
        echo ""
    fi
done

if [ "$FOUND_BLOCKED" = true ]; then
    echo "These directories are for temporary work and should not be committed."
    echo ""
    echo "To fix this, unstage the files:"
    echo "  git reset HEAD scratch/ claude-iterate/workspaces/"
    echo ""
    echo "For completed work:"
    echo "  - Save as template: claude-iterate template save <workspace> <name>"
    echo "  - Archive workspace: claude-iterate archive save <workspace>"
    echo ""
    echo "To bypass this hook (not recommended):"
    echo "  git commit --no-verify"
    exit 1
fi

exit 0
